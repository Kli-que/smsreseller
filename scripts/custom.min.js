$(document).ready(function () {

	//login data collection
     $('#login').click(function () {
               $('#login').prop('disabled', true);
               $('#login').html('<span class="fa fa-circle-o-notch fa-spin"></span>');

               var username = $("#username").val();
               var password = $("#password").val();

               $.post("../resources/login.php",

               { 
                    username:username,
                    password:password
               },

          function(response) {
               if (response == "") {
                    window.location.href = "managecontacts";
               }
               else{
                    $('#errors').html(response);
                    $("#login").prop("disabled", false);
                    $('#login').html('Sign in');
               }
               
          })
     });


	//sign up data collection

          $("#signup").click(function (){
               $('#signup').prop('disabled', true);
               $('#signup').html('<span class="fa fa-circle-o-notch fa-spin"></span>');

               var username = $("#username").val();
               var phone = $("#phone").val();
               var password = $("#password").val();
               var confirmpass = $("#confirmpassword").val();

               $.post("../resources/processsignup.php",

               { 
                    username:username,
                    phone:phone,
                    password:password,
                    confirmpass:confirmpass
               },

          function(response,status) {
               if (response == "") 
               {
                    window.location.href = "managecontacts";
               }else{
                    $("#errors").html(response);
                    $("#signup").prop("disabled", false);
                    $('#signup').html('Sign Up');
               }
               
          })
          });


	//enter the confirmation code sent to your phone number
	
     $("#reset").click(function(){
          $('#reset').prop('disabled',true);
          $('#reset').html('<span class="fa fa-circle-o-notch fa-spin"></span>');

          var resetcode = $('#confirmcode').val();

          $.post("../resources/reset.php",

          { 
               resetcode:resetcode
          },

          function(response) {
               
               if (response == "") {
                    window.location.href = "signup";
               }
               else{
                    $('#errors').html(response);
                    $('#reset').prop('disabled',false);
                    $('#reset').html('Continue <span class="fa fa-arrow-right"></span>');

               }

          }
       );
     });

     //collect the group name when the one hits the add group button

     $("#savegroup").click(function() {
          $("#savegroup").prop("disabled", true);
          $("#savegroup").html("Adding...");

          var grpname = $("#grpname").val();


          $.post("../resources/addgroup.php",

          { 
               grpname:grpname
          },

          function(response) {
               
               if (response == "") {
                    window.location.href = "managecontacts";
               }
               else{
                    $('#grouperrors').html(response);
                    $('#savegroup').prop('disabled',false);
                    $('#savegroup').html('Add Group');

               }

          })

     });

     //Add a new contact to the database
     $("#savenewcontact").click(function() {
          $("#savenewcontact").prop('disabled', true);
          $("#savenewcontact").html("Saving Contact...");

          var contactname = $("#contactname").val();
          var contactphone = $("#contactphone").val();


          $.post("../resources/addnewcontact.php",

          { 
               contactname:contactname,
               contactphone:contactphone
          },

          function(response) {
               
               if (response == "") {
                    window.location.href = "managecontacts";
               }
               else{
                    $('#contacterrors').html(response);
                    $('#savenewcontact').prop('disabled',false);
                    $('#savenewcontact').html('Save');

               }
          })
     });

     // when the user clicks a certain group, display the contacts in the group
     $(".displaygrpcontacts").click(function() {
          $("#allconts").hide();
          var data_id = $(this).data('id');
          $("#displaygrpcontacts").each(function() {
               $.post('../resources/displaygrpcontacts.php', 

               {
                    data:data_id
               }, 

               function(data, textStatus, xhr) {
                    if (data == "") {
                         $("#contactscolumn").html("<div class= 'text-muted text-center' style='margin-top:250px;'><h1>No contacts to display</h1></div>");
                    }
                    else{
                         $("#contactscolumn").html(data);
                    }
               });
          });
     });

     //display all contacts after user hits the all contacts button
     $("#displayallcontacts").click(function() {
          window.location.href = "managecontacts";
     });

     //get the values of the checked inputs when i click on the delete contacts button

     $("#deletecontact").click(function() {
          $("#yesdeletecontacts").click(function() {
          var contactid = [];
          $('input[name=checkedcontact]').each(function() {
               if($(this).prop('checked')){
                    contactid.push($(this).val());

                    $.post('../resources/deletecontact', 

                    {
                         contactid: contactid
                    },

                    function(data, textStatus, xhr) {
                         if (data == "") {
                              window.location.href = "managecontacts";
                         }
                         else{
                              $("#selectcontacterrors").html(data);
                         }
                    });
               }
          });
               if (contactid == "") {
                    $("#selectcontacterrors").html("<span style='color:red;'>Please select at least one contact.<span>");
               }
          });
     });


     //what happens when user hits send message button on the manage contacts page
     $("#sendmsg").click(function () {
          window.location.href = "sendsms";
     })


     //what happens when the send SMS button is hit

     $("#sendbulksms").click(function() {
          $("#sendbulksms").prop('disabled', true);
          $("#sendbulksms").html("Sending SMS...");

          var selected = $("#selectedgroup").val();
          var message  = $("#messagearea").val();

          $.post('../resources/validatesms', 
          {
               selectedgroup: selected,
               message      : message
          }, 
          function(data, textStatus, xhr) {
               if (data == "") {
                    alert("Success");
               }
               else{
                    $('#errors').html(data);
                    $('#sendbulksms').prop('disabled',false);
                    $('#sendbulksms').html('Send Message');
               }
          });
          
     });


     // What happens when i want to delete a single contact

     $("a[id=deletesinglecnt]").each(function() {
          $(this).click(function() {
               var specificcontact = $(this).data('specificcontact');

               $.post('../resources/deletesinglecontact', 

               {
                    contactid: specificcontact
               }, 

               function(data, textStatus, xhr) {
                    if (data == "") {
                         window.location.href = "managecontacts";
                    }
               });
          });
     });


     // How about we edit the contact now

     $("a[id=editcontact]").each(function() {
          $(this).click(function() {
               var specificcont = $(this).data('contactid');

               $.post('../resources/editcontact', 
               
               {
                    contactid: specificcont,
                    dataType: 'json'
               }, 

               function(data, textStatus, xhr) {
                    var dataarray = JSON.parse(data);
                    $("#editName").val(dataarray[0]);
                    $("#editPhone").val(dataarray[1]);
               });
               
               
          })

     })


     $("#editcontactbtn").click(function() {
          $("#editcontactbtn").prop('disabled', true);
          $("#editcontactbtn").html("Please wait...");
          
          var newname  = $("#editName").val();
          var newphone = $("#editPhone").val();


          $.post('../resources/editnameandphone.php', 
          {
               newname:  newname,
               newphone: newphone
          }, 
          
          function(data, textStatus, xhr) {
               if (data == "") {
                    window.location.href = "managecontacts";
               }
               else{
                    $("#editcontactbtn").prop('disabled', false);
                    $("#editcontactbtn").html("Edit");
                    $("#editerrors").html(data);
               }
          });

     });


     // Send a single sms to a specific person

     $("a[id=sendsinglesms]").each(function() {
          $(this).click(function() {

               var specificcont = $(this).data('specificcontact');

               $.post('../resources/selectcontactname', 
               
               {
                    contactid: specificcont,
                    dataType: 'json'
               }, 

               function(data, textStatus, xhr) {
                    var dataarray = JSON.parse(data);
                    $("#sendto").val(dataarray[0]+"("+ dataarray[1]+")");
               });
               
               
          })

     })


     // Change account password


     $("#changepassword").click(function() {
          $("#changepassword").prop('disabled', true);
          $("#changepassword").html("Updating...");

          var oldpassword = $("#oldpassword").val();
          var newpassword = $("#newpassword").val();
          var newpassconfirm = $("#newpassconfirm").val();

          $.post('../resources/changepassword', 
          {
               oldpassword   : oldpassword,
               newpassword   : newpassword,
               newpassconfirm: newpassconfirm
          }, 

          function(data, textStatus, xhr) {

               if (data == "") {
                    $("#changepasserrors").html("Password was changed successfully");
               }
               else{
                    $("#changepasserrors").html(data);
                    $("#changepassword").html("Change Password");
                    $("#changepassword").prop('disabled', false);
               }
          });

     });


     //Aaaand back to home

     $("#backtohome").click(function() {
          window.location.href = "managecontacts";
     });


     // Delete user account

     $("#yesdeleteaccount").click(function() {
          var doesnothing = "";

          $.post('../resources/deleteaccount', 
          {
               doesnothing:doesnothing
          }, 

          function(data, textStatus, xhr) {
               if (data == "") {
                    window.location.href = "../dashboard/"
               }
          });
     });


     //Send messages to specific contacts

     $('a[id=sendtospecific]').click(function(event) {
               var contactselected = [];
               $('input[name=checkedcontact]').each(function() {
               if($(this).prop('checked')){
                    contactselected.push($(this).val());

                    $.post('../resources/sendtospecific', 
                    {
                         contactselected: contactselected
                    }, 
                    function(data, textStatus, xhr) {
                         var contacts = JSON.parse(data);
                         $("#specificcontacts").val(contacts);
                    });
               }
          })
     });




})